{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-12">
    <!-- Header Block -->
    <div class="noir-border bg-[var(--bg-alt)] p-8 flex flex-col md:flex-row items-center gap-8">
        <div class="relative w-40 h-40 noir-border bg-accent/10 flex items-center justify-center overflow-hidden">
            {% if user.profile_pic_url %}
                <img src="{{ user.profile_pic_url }}" class="w-full h-full object-cover" alt="{{ user.username }}" style="object-position: {{ user.profile_pic_position or '50% 50%' }}">
            {% else %}
                <span class="text-6xl font-bold opacity-20 mono-display">{{ user.username[0].upper() }}</span>
            {% endif %}
        </div>

        <div class="flex-1 space-y-4 text-center md:text-left">
            <div class="space-y-1">
                <h1 class="text-4xl font-bold mono-display tracking-tighter uppercase flex items-center justify-center md:justify-start gap-3">
                    {{ user.username }}
                    {% if user.is_verified %}
                    <svg class="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    {% endif %}
                </h1>
                <div class="text-[10px] font-bold opacity-50 uppercase tracking-widest flex items-center justify-center md:justify-start gap-2">
                    <span>ENROLLED: {{ user.date_joined.strftime('%Y.%m.%d') }}</span>
                    {% if user.show_last_seen %}
                        {% set is_online = (now - user.last_seen).total_seconds() < 300 if now else false %}
                        <span>//</span>
                        <span class="{{ 'text-accent' if is_online else '' }}">STATUS: {{ 'ONLINE' if is_online else 'OFFLINE' }}</span>
                    {% endif %}
                </div>
            </div>

            {% if user.bio %}
                <div class="noir-border border-accent/20 p-3 bg-accent/5">
                    <p class="text-xs italic opacity-80 leading-relaxed font-bold">"{{ user.bio }}"</p>
                </div>
            {% endif %}

            <div class="pt-2">
                {% if user.id != current_user.id %}
                    {% if status == 'none' %}
                        <form action="{{ url_for('social.send_friend_request', user_id=user.id) }}" method="POST">
                            <button type="submit" class="noir-button px-8 text-xs">SEND_FRIEND_INVITE</button>
                        </form>
                    {% elif status == 'sent' %}
                        <button disabled class="noir-button-outline px-8 text-xs opacity-50">INVITE_PENDING</button>
                    {% elif status == 'received' %}
                        <div class="flex gap-2">
                            <form action="{{ url_for('social.respond_friend_request', user_id=user.id, action='accept') }}" method="POST">
                                <button class="noir-button px-6 text-xs">ACCEPT</button>
                            </form>
                            <form action="{{ url_for('social.respond_friend_request', user_id=user.id, action='reject') }}" method="POST">
                                <button class="noir-button-outline px-6 text-xs">REJECT</button>
                            </form>
                        </div>
                    {% elif status == 'accepted' %}
                        <form action="{{ url_for('social.respond_friend_request', user_id=user.id, action='remove') }}" method="POST">
                             <button class="noir-button-outline px-8 text-xs">TERMINATE_FRIENDSHIP</button>
                        </form>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Stats Matrix -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="noir-border bg-[var(--bg-alt)] flex flex-col items-center justify-center space-y-2">
            <span class="text-[10px] font-bold opacity-50 uppercase tracking-widest">Total_Accumulated_Focus</span>
            <span class="text-5xl font-bold mono-display text-accent tracking-tighter">{{ total_minutes | format_minutes }}</span>
        </div>
        <div class="noir-border bg-[var(--bg-alt)] flex flex-col items-center justify-center space-y-2">
            <span class="text-[10px] font-bold opacity-50 uppercase tracking-widest">Successful_Cycles_Completed</span>
            <span class="text-5xl font-bold mono-display text-accent tracking-tighter">{{ total_sessions }}</span>
        </div>
    </div>

    <!-- Achievements Array -->
    <div class="noir-border bg-[var(--bg-alt)]">
        <div class="p-4 border-b noir-border flex justify-between items-center bg-accent/5">
            <h2 class="text-sm font-bold uppercase tracking-widest">Unlocked_Achievement_Badges</h2>
            <span class="text-[10px] font-bold opacity-50">{{ user.achievements | length }} RECORDS</span>
        </div>
        <div class="p-8">
            {% if user.achievements %}
                <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-6">
                    {% for ua in user.achievements %}
                        <div class="flex flex-col items-center space-y-2 group relative" title="{{ ua.achievement.description }}">
                            <div class="text-4xl noir-border w-16 h-16 flex items-center justify-center bg-[var(--bg-alt)] grayscale group-hover:grayscale-0 transition-all border-dashed">
                                {{ ua.achievement.icon }}
                            </div>
                            <span class="text-[8px] font-bold text-center uppercase tracking-tighter leading-none">{{ ua.achievement.name }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12 opacity-30">
                    <span class="text-xs font-bold uppercase tracking-widest">NO_ACHIEVEMENTS_RECORDED_IN_DATABASE</span>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
