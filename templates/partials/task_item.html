<div id="task-{{ task.id }}" class="group flex items-start gap-6 noir-border noir-container bg-[var(--bg-alt)] hover:border-accent transition-colors">
    <!-- Status Check -->
    <div class="flex-shrink-0 pt-1">
        <button hx-post="{{ url_for('main.toggle_task', task_id=task.id) }}" hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}' 
                hx-target="#task-{{ task.id }}" 
                hx-swap="outerHTML"
                class="w-8 h-8 border flex items-center justify-center transition-colors {{ 'border-accent bg-accent/10 text-accent' if task.status == 'done' else 'noir-border hover:border-accent' }}">
            {% if task.status == 'done' %}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
            {% endif %}
        </button>
    </div>

    <!-- Content -->
    <div class="flex-1 min-w-0 space-y-2">
        <div class="flex items-center gap-4">
            <span class="text-xl font-bold truncate {{ 'line-through opacity-40' if task.status == 'done' else 'opacity-100' }}">{{ task.title }}</span>
            {% if task.priority > 1 %}
                <span class="text-[10px] font-bold px-2 py-0.5 border border-accent text-accent uppercase tracking-widest">P_{{ task.priority }}</span>
            {% endif %}
        </div>

        {% if task.description %}
            <p class="text-xs font-bold opacity-80 leading-relaxed max-w-2xl {{ 'line-through opacity-30' if task.status == 'done' else '' }}">
                {{ task.description }}
            </p>
        {% endif %}
        
        <div class="flex items-center gap-6">
            <!-- Pomodoro Progress -->
            <div class="flex gap-1.5">
                {% for i in range(task.estimated_pomodoros) %}
                    <div class="w-2.5 h-2.5 border {{ 'bg-accent border-accent' if i < task.completed_pomodoros else 'opacity-20 border-accent' }}"></div>
                {% endfor %}
            </div>
            
            {% if task.tags %}
                <div class="flex gap-3">
                    {% for tag in task.tags %}
                        <span class="noir-tag">#{{ tag.name }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Subtasks Section -->
        {% if task.subtasks %}
        <div class="mt-4 space-y-2 border-l-2 border-accent/20 pl-4 py-1">
            {% for subtask in task.subtasks %}
                <div class="flex items-center gap-3 group/sub">
                    <button hx-post="{{ url_for('main.toggle_subtask', subtask_id=subtask.id) }}" hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}'
                            hx-target="#task-{{ task.id }}"
                            hx-swap="outerHTML"
                            class="w-4 h-4 border flex items-center justify-center transition-colors {{ 'border-accent bg-accent/10 text-accent' if subtask.is_completed else 'border-accent/40' }}">
                        {% if subtask.is_completed %}
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        {% endif %}
                    </button>
                    <span class="text-[11px] font-bold uppercase tracking-wider cursor-pointer {{ 'line-through opacity-60' if subtask.is_completed else 'opacity-100' }}"
                          hx-get="{{ url_for('main.get_edit_subtask', subtask_id=subtask.id) }}"
                          hx-trigger="dblclick"
                          hx-target="this"
                          hx-swap="outerHTML"
                          title="Double-click to edit">
                        {{ subtask.title }}
                    </span>
                    <button hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}' hx-delete="{{ url_for('main.delete_subtask', subtask_id=subtask.id) }}"
                            hx-target="#task-{{ task.id }}"
                            hx-swap="outerHTML"
                            class="opacity-0 group-hover/sub:opacity-100 text-[8px] font-bold text-red-600 uppercase hover:underline">
                        [DEL]
                    </button>
                </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <form hx-post="{{ url_for('main.add_subtask', task_id=task.id) }}" hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}' 
              hx-target="#task-{{ task.id }}"
              hx-swap="outerHTML"
              class="mt-3 flex gap-2 opacity-60 focus-within:opacity-100 transition-opacity">
            <input type="text" name="title" placeholder="ADD_SUBTASK" 
                   class="bg-transparent border-b border-accent/20 text-[10px] font-bold uppercase tracking-widest focus:border-accent outline-none py-1 w-full max-w-[200px] placeholder-[var(--text-main)] placeholder:opacity-60">
            <button type="submit" class="text-[10px] font-bold text-accent uppercase hover:underline">[+]</button>
        </form>
    </div>

    <!-- Actions -->
    <div class="flex items-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity">
        <button hx-get="{{ url_for('main.get_edit_task', task_id=task.id) }}" hx-target="#task-{{ task.id }}" class="text-[10px] font-bold hover:text-accent uppercase underline underline-offset-4 tracking-widest">Edit</button>
        <button hx-delete="{{ url_for('main.delete_task', task_id=task.id) }}" hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}' hx-target="#task-{{ task.id }}" hx-swap="delete" class="text-[10px] font-bold hover:text-red-600 uppercase underline underline-offset-4 tracking-widest">Delete</button>
    </div>
</div>
