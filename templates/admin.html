{% extends "base.html" %}

{% block content %}
<div class="max-w-6xl mx-auto space-y-12">
    <!-- Header Section -->
    <div class="flex items-baseline justify-between noir-header pb-4">
        <h1 class="text-4xl font-bold tracking-tighter mono-display uppercase flex items-center gap-6">
            Admin_Console
            <span class="text-xs font-normal border border-green-500 text-green-500 px-3 py-1 flex items-center gap-2">
                <span class="w-1.5 h-1.5 bg-green-500 animate-pulse"></span>
                {{ online_count }} NODE(S) ACTIVE
            </span>
        </h1>
        <span class="text-xs font-bold opacity-50 uppercase tracking-widest">ACCESS_LEVEL: {{ current_user.username }} // ROOT</span>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="noir-border bg-[var(--bg-alt)] p-6 space-y-2">
            <p class="text-[10px] font-bold opacity-40 uppercase tracking-widest">Total_Subjects</p>
            <p class="text-3xl font-bold mono-display">{{ total_users }}</p>
            <p class="text-[9px] font-bold text-green-500 uppercase">+{{ new_users_7d }} LAST_7_DAYS</p>
        </div>
        <div class="noir-border bg-[var(--bg-alt)] p-6 space-y-2">
            <p class="text-[10px] font-bold opacity-40 uppercase tracking-widest">Global_Focus_Hours</p>
            <p class="text-3xl font-bold mono-display text-accent">{{ total_focus_hours }}</p>
            <p class="text-[9px] font-bold opacity-30 uppercase">AGGREGATED_SYSTEM_RUNTIME</p>
        </div>
        <div class="noir-border bg-[var(--bg-alt)] p-6 space-y-2">
            <p class="text-[10px] font-bold opacity-40 uppercase tracking-widest">Tasks_Neutralized</p>
            <p class="text-3xl font-bold mono-display">{{ total_tasks_completed }}</p>
            <p class="text-[9px] font-bold opacity-30 uppercase">OBJECTIVES_COMPLETED</p>
        </div>
        <div class="noir-border bg-[var(--bg-alt)] p-6 space-y-2 border-accent/20">
            <p class="text-[10px] font-bold opacity-40 uppercase tracking-widest">System_Status</p>
            <p class="text-3xl font-bold mono-display text-green-500">OPTIMAL</p>
            <p class="text-[9px] font-bold opacity-30 uppercase">DATA_INTEGRITY_100%</p>
        </div>
    </div>

    <div class="noir-border bg-[var(--bg-alt)] overflow-hidden">
        <table class="min-w-full border-collapse">
            <thead>
                <tr class="bg-black text-white dark:bg-white dark:text-black">
                    <th class="px-6 py-4 text-left text-[10px] font-bold uppercase tracking-[0.2em]">IDENT_SUBJECT</th>
                    <th class="px-6 py-4 text-left text-[10px] font-bold uppercase tracking-[0.2em]">STATUS_BIT</th>
                    <th class="px-6 py-4 text-left text-[10px] font-bold uppercase tracking-[0.2em]">HARDWARE_TIMINGS</th>
                    <th class="px-6 py-4 text-right text-[10px] font-bold uppercase tracking-[0.2em]">PROTOCOLS</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-black dark:divide-white divide-opacity-10">
                {% for user in users %}
                <tr class="{{ 'bg-accent/5' if user.is_admin else '' }}">
                    <td class="px-6 py-6">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 noir-border bg-accent/10 flex items-center justify-center font-bold text-xs">
                                {{ user.username[0].upper() }}
                            </div>
                            <div>
                                <p class="text-sm font-bold flex items-center gap-2">
                                    {{ user.username }}
                                    {% if user.is_verified %}
                                        <svg class="w-3.5 h-3.5 text-accent fill-current" viewBox="0 0 24 24"><path d="M23 12l-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.7l-3.61.81.34 3.7L1 12l2.44 2.79-.34 3.69 3.61.82 1.89 3.2L12 21.04l3.4 1.46 1.89-3.2 3.61-.82-.34-3.69L23 12zm-12.91 4.72l-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48-7.33 7.35z"/></svg>
                                    {% endif %}
                                    {% if user.last_seen and (now - user.last_seen.replace(tzinfo=now.tzinfo)).total_seconds() < 300 %}
                                        <span class="text-[8px] bg-green-500 text-white px-1 py-0.5 tracking-tighter">ONLINE</span>
                                    {% endif %}
                                </p>
                                <p class="text-[9px] font-bold opacity-40 uppercase truncate max-w-[150px]">{{ user.bio or 'NO_BIO_DATA' }}</p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-6">
                        {% if user.is_banned %}
                            <span class="text-[10px] font-bold text-red-600 border border-red-600 px-2 py-0.5 uppercase">VOIDED</span>
                        {% else %}
                            <span class="text-[10px] font-bold text-green-600 border border-green-600 px-2 py-0.5 uppercase">STABLE</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-6">
                        <form action="{{ url_for('main.admin_edit_timer', user_id=user.id) }}" method="POST" class="flex items-center gap-2">
                            <input type="number" name="focus_duration" value="{{ user.focus_duration }}" class="w-12 noir-input text-[10px] py-1 text-center font-bold">
                            <span class="opacity-30 text-[10px]">/</span>
                            <input type="number" name="break_duration" value="{{ user.break_duration }}" class="w-12 noir-input text-[10px] py-1 text-center font-bold">
                            <button class="text-accent hover:opacity-100 opacity-50">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            </button>
                        </form>
                    </td>
                    <td class="px-6 py-6 text-right">
                        <div class="flex flex-wrap justify-end gap-2">
                            <form action="{{ url_for('main.admin_toggle_role', user_id=user.id) }}" method="POST">
                                <button class="text-[9px] font-bold border noir-border px-2 py-1 hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black transition uppercase">
                                    {{ 'Demote' if user.is_admin else 'Elevate' }}
                                </button>
                            </form>

                            {% if user.username != 'lost' %}
                            <form action="{{ url_for('main.admin_ban_user', user_id=user.id) }}" method="POST">
                                <button class="text-[9px] font-bold border border-red-600 text-red-600 px-2 py-1 hover:bg-red-600 hover:text-white transition uppercase">
                                    {{ 'Restore' if user.is_banned else 'Void' }}
                                </button>
                            </form>
                            {% endif %}

                            {% if user.id != current_user.id %}
                            <form action="{{ url_for('main.admin_logout_user', user_id=user.id) }}" method="POST">
                                <button class="text-[9px] font-bold bg-amber-600 text-white px-2 py-1 hover:brightness-110 transition uppercase">
                                    EJECT
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
